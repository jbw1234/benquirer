"use strict";var $=window.jQuery;var listReg=/formList\[([^\]]+)\]/;var newsletterStrings=window.amiNewsletterStrings;var $form;var $submit;var $success;var $messaging;function normalizeFields(fields){return fields.reduce(function(pred,field){var match=field.name.match(listReg);if(match){pred.forms.push(field.value);}else if('subscriber_source'===field.name){pred.subscriber_source=field.value;pred.user[field.name]=field.value;}else{pred.user[field.name]=field.value;}
return pred;},{forms:[],subscriber_source:'',user:{}});};function getUserToken(userData){return $.ajax({type:"POST",url:newsletterStrings.userEndpoint,data:JSON.stringify(userData),headers:{"content-type":"application/json"}});};function addToLists(listData,subscriberSource){return function(userObject){var listRequests=[];for(var i=0;i<listData.length;i++){var listRequest={listID:listData[i],userID:userObject.userID,subscriber_source:subscriberSource};listRequests.push($.ajax({type:"POST",url:newsletterStrings.listEndpoint,data:JSON.stringify(listRequest),headers:{"content-type":"application/json"}}));}
return $.when.apply($,listRequests);};};function handleSuccess(){$form.hide();$messaging.hide();$success.show();};function handleFail(submitErr){var response=submitErr.responseJSON||{};var errMessage=newsletterStrings.defaultError;if('rest_invalid_param'===response.code&&null!==response.data){if(response.data.params.zip){errMessage=response.data.params.zip;}else if(response.data.params.email){errMessage=response.data.params.email;}else{errMessage=response.message;}}else if(response.message){errMessage=response.message;}
$submit.removeAttr("disabled");$messaging.text(errMessage).css({color:"red"});};function processSubmit(){var formFields=normalizeFields($form.serializeArray());$submit.attr("disabled","disabled");$messaging.removeAttr("style").text(newsletterStrings.processMessage);getUserToken(formFields.user).then(addToLists(formFields.forms,formFields.subscriber_source)).then(handleSuccess,handleFail);};function handleSubmit(e){e.preventDefault();processSubmit();};function init(currentForm){if(!currentForm.length){return;}
currentForm.on("submit",function(e){$form=$(this);$submit=$form.find(".newsletter-form__submit");$success=$form.siblings(".newsletter-signup__success");$messaging=$form.siblings(".newsletter-signup__messaging");handleSubmit(e);});};$(".newsletter-form").each(function(){var thisForm=$(this);init(thisForm);});
;!function(d,l){"use strict";var e=!1,o=!1;if(l.querySelector)if(d.addEventListener)e=!0;if(d.wp=d.wp||{},!d.wp.receiveEmbedMessage)if(d.wp.receiveEmbedMessage=function(e){var t=e.data;if(t)if(t.secret||t.message||t.value)if(!/[^a-zA-Z0-9]/.test(t.secret)){var r,a,i,s,n,o=l.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),c=l.querySelectorAll('blockquote[data-secret="'+t.secret+'"]');for(r=0;r<c.length;r++)c[r].style.display="none";for(r=0;r<o.length;r++)if(a=o[r],e.source===a.contentWindow){if(a.removeAttribute("style"),"height"===t.message){if(1e3<(i=parseInt(t.value,10)))i=1e3;else if(~~i<200)i=200;a.height=i}if("link"===t.message)if(s=l.createElement("a"),n=l.createElement("a"),s.href=a.getAttribute("src"),n.href=t.value,n.host===s.host)if(l.activeElement===a)d.top.location.href=t.value}}},e)d.addEventListener("message",d.wp.receiveEmbedMessage,!1),l.addEventListener("DOMContentLoaded",t,!1),d.addEventListener("load",t,!1);function t(){if(!o){o=!0;var e,t,r,a,i=-1!==navigator.appVersion.indexOf("MSIE 10"),s=!!navigator.userAgent.match(/Trident.*rv:11\./),n=l.querySelectorAll("iframe.wp-embedded-content");for(t=0;t<n.length;t++){if(!(r=n[t]).getAttribute("data-secret"))a=Math.random().toString(36).substr(2,10),r.src+="#?secret="+a,r.setAttribute("data-secret",a);if(i||s)(e=r.cloneNode(!0)).removeAttribute("security"),r.parentNode.replaceChild(e,r)}}}}(window,document);